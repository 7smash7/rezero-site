<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion / Inscription – Re:Zero</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0f18; --panel:#121829; --txt:#e9eefc; --muted:#9aa4c7; --accent:#7c9aff; --err:#ff6b6b; }
    *{box-sizing:border-box} html,body{margin:0;height:100%}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,#0b0f18 0%, #141a2e 60%, #0b0f18 100%);color:var(--txt);display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:860px;display:grid;grid-template-columns:1fr 1fr;gap:0;background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 20px 70px rgba(0,0,0,.45);overflow:hidden}
    .left{padding:28px}
    .right{padding:28px;border-left:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,rgba(124,154,255,.08),transparent)}
    h1{margin:0 0 8px;font-size:22px;letter-spacing:.4px}
    p.sub{margin:0 0 20px;color:var(--muted);font-size:14px}
    form{display:flex;flex-direction:column;gap:12px;margin-top:8px}
    label{font-size:13px;color:var(--muted)}
    input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);color:var(--txt);outline:none}
    input::placeholder{color:#98a2c3}
    button{padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:var(--accent);color:#0b0f18;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;color:var(--txt)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .muted{color:var(--muted);font-size:12px}
    .err{color:var(--err);font-size:13px;min-height:18px;margin-top:4px}
    .ok{color:#6ef3a5;font-size:13px;min-height:18px;margin-top:4px}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:18px 0}
    .footer{margin-top:12px;font-size:12px;color:var(--muted)}
    @media(max-width:860px){.card{grid-template-columns:1fr}}
  </style>
</head>
<body>

  <div class="card">
    <!-- INSCRIPTION -->
    <section class="left">
      <h1>Créer un compte</h1>
      <p class="sub">Rejoins l’univers. Tu pourras créer et publier tes personnages.</p>

      <form id="form-signup" autocomplete="on">
        <div>
          <label>Email</label>
          <input name="email" type="email" placeholder="ton@email.fr" required />
        </div>
        <div class="row">
          <div>
            <label>Mot de passe</label>
            <input name="password" type="password" placeholder="••••••••" minlength="6" required />
          </div>
          <div>
            <label>Confirme</label>
            <input name="password2" type="password" placeholder="••••••••" minlength="6" required />
          </div>
        </div>
        <button type="submit">Créer mon compte</button>
        <div id="msg-signup" class="err"></div>
        <div id="ok-signup" class="ok"></div>
      </form>

      <div class="hr"></div>
      <div class="footer muted">Astuce : tu pourras définir ton @username plus tard dans “Mon compte”.</div>
    </section>

    <!-- CONNEXION -->
    <section class="right">
      <h1>Se connecter</h1>
      <p class="sub">Déjà inscrit ? Accède à ton espace.</p>

      <form id="form-signin" autocomplete="on">
        <div>
          <label>Email</label>
          <input name="email" type="email" placeholder="ton@email.fr" required />
        </div>
        <div>
          <label>Mot de passe</label>
          <input name="password" type="password" placeholder="••••••••" minlength="6" required />
        </div>
        <button type="submit">Connexion</button>
        <button type="button" id="btn-magic" class="secondary">Recevoir un lien magique</button>
        <div id="msg-signin" class="err"></div>
        <div id="ok-signin" class="ok"></div>
      </form>

      <div class="hr"></div>
      <div class="footer muted">Besoin d’aide ? Vérifie que ton navigateur n’a pas bloqué les pop-ups de connexion.</div>
    </section>
  </div>

  <!-- 1) Librairie Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- 2) Ton client partagé (celui que tu as déjà créé) -->
  <script src="js/config.js"></script>

  <!-- 3) Logique de cette page -->
  <script>
    // Inscription
    document.getElementById('form-signup').addEventListener('submit', async (e) => {
      e.preventDefault();
      const msgErr = document.getElementById('msg-signup');
      const msgOk  = document.getElementById('ok-signup');
      msgErr.textContent = ""; msgOk.textContent = "";

      const email = e.target.email.value.trim();
      const p1 = e.target.password.value.trim();
      const p2 = e.target.password2.value.trim();
      if (p1 !== p2) { msgErr.textContent = "Les mots de passe ne correspondent pas."; return; }

      const { data, error } = await sb.auth.signUp({ email, password: p1 });
      if (error) { msgErr.textContent = error.message; return; }

      // Crée un profil minimal pour l’utilisateur nouvellement créé
      const user = data.user;
      if (user) {
        await sb.from('profiles').upsert({ id: user.id, level: 1 });
      }

      msgOk.textContent = "Compte créé ✅ — redirection…";
      setTimeout(()=>{ location.href = "account.html"; }, 600);
    });

    // Connexion
    document.getElementById('form-signin').addEventListener('submit', async (e) => {
      e.preventDefault();
      const msgErr = document.getElementById('msg-signin');
      const msgOk  = document.getElementById('ok-signin');
      msgErr.textContent = ""; msgOk.textContent = "";

      const email = e.target.email.value.trim();
      const password = e.target.password.value.trim();

      const { error } = await sb.auth.signInWithPassword({ email, password });
      if (error) { msgErr.textContent = error.message; return; }

      msgOk.textContent = "Connexion réussie ✅ — redirection…";
      setTimeout(()=>{ location.href = "account.html"; }, 600);
    });

    // Lien magique (optionnel, pratique)
    document.getElementById('btn-magic').addEventListener('click', async () => {
      const emailInput = document.querySelector('#form-signin input[name="email"]');
      const email = (emailInput?.value || "").trim();
      const box = document.getElementById('ok-signin');
      const err = document.getElementById('msg-signin');
      box.textContent = ""; err.textContent = "";
      if (!email) { err.textContent = "Entre ton email pour recevoir un lien."; return; }

      const { error } = await sb.auth.signInWithOtp({ email });
      if (error) { err.textContent = error.message; return; }
      box.textContent = "Lien magique envoyé ✅ (vérifie ta boîte mail)";
    });
  </script>
</body>
</html>
